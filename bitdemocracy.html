<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Simulator with Policies</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: rgb(60, 98, 117);
        }

        #game-container {
            display: flex;
            background-color: rgb(70.2, 76.1, 78.4);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-height: 80vh;
        }

        #menu,
        #stats {
            width: 250px;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 20px;
            background-color: white;
        }

        #policies {
            width: 250px;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: white;
        }

        .menu-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .selected {
            background-color: rgb(60, 98, 117);
            color: white;
        }

        /* Styling for scrollbars */
        #menu::-webkit-scrollbar,
        #stats::-webkit-scrollbar {
            width: 10px;
        }

        #menu::-webkit-scrollbar-track,
        #stats::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        #menu::-webkit-scrollbar-thumb,
        #stats::-webkit-scrollbar-thumb {
            background: #888;
        }

        #menu::-webkit-scrollbar-thumb:hover,
        #stats::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <div id="menu"></div>
        <div id="stats"></div>
        <div id="policies"></div>
    </div>

    <script>

        /*
        What this code does:
        - It creates a simple country simulator game where you can select a country and apply policies to it
        - The game has a few stats for each country like population, GDP, corruption level, etc.
        - Based on the policies you apply, the game gerenates events for the next year
        - Events are situations that happen in the country based on the policies you applied
        - You have to handle the events to continue the game
        - The goal of the game is to have your contry become a consolidated democracy
        */

        class Country {
            constructor() {
                this.population = 0;
                this.gdp = 0;
                this.corruption_perceptions_index = 0.0;
                this.hdi = 0;
                this.gini_index = 0;
                this.freedom_house_rating = 0;
                this.fragile_states_index = 0;
            }

            countryStats = {
                "UK": {
                    "population": 67059000,
                    "gdp": 23174000000,
                    "corruption_preceptions_index": 0.6,
                    "hdi": 0.9,
                    "gini_index": 32.5,
                    "freedom_house_rating": 15,
                    "fragile_states_index": 14
                },
                "China": {
                    "population": 1409517377,
                    "gdp": 1337120000000,
                    "corruption_preceptions_index": 0.4,
                    "hdi": 0.9,
                    "gini_index": 35.5,
                    "freedom_house_rating": 17,
                    "fragile_states_index": 21
                },
                "Iran": {
                    "population": 83769853,
                    "gdp": 23215500000,
                    "corruption_preceptions_index": 0.2,
                    "hdi": 0.7,
                    "gini_index": 31.3,
                    "freedom_house_rating": 9,
                    "fragile_states_index": 18
                },
                "Russia": {
                    "population": 146934462,
                    "gdp": 290800000000,
                    "corruption_preceptions_index": 0.7,
                    "hdi": 0.85,
                    "gini_index": 39.1,
                    "freedom_house_rating": 4,
                    "fragile_states_index": 24
                },
                "Mexico": {
                    "population": 134529582,
                    "gdp": 23146000000,
                    "corruption_preceptions_index": 0.5,
                    "hdi": 0.85,
                    "gini_index": 43.1,
                    "freedom_house_rating": 12,
                    "fragile_states_index": 29
                },
                "Nigeria": {
                    "population": 209485321,
                    "gdp": 63457000000,
                    "corruption_preceptions_index": 0.8,
                    "hdi": 0.65,
                    "gini_index": 37.1,
                    "freedom_house_rating": 7,
                    "fragile_states_index": 28
                }
            }

            loadStats(country_name) {
                // Update the statistics based on the current country
                this.population = this.countryStats[country_name]["population"]
                this.gdp = this.countryStats[country_name]["gdp"]
                this.corruption_preceptions_index = this.countryStats[country_name]["corruption_preceptions_index"]
                this.hdi = this.countryStats[country_name]["hdi"]
                this.gini_index = this.countryStats[country_name]["gini_index"]
                this.freedom_house_rating = this.countryStats[country_name]["freedom_house_rating"]
                this.fragile_states_index = this.countryStats[country_name]["fragile_states_index"]
            }

        }

        class Logic {
            constructor() {
                this.country = new Country();
                this.country_name = null;

                // Load in the menu.json file
                fetch('data/menu.json')
                    .then(response => response.json())
                    .then(data => {
                        this.menuItems = data;
                    });

                // Load in the submenu.json file
                fetch('data/submenu.json')
                    .then(response => response.json())
                    .then(data => {
                        this.submenus = data;
                    });

                // Load in the policies.json file
                fetch('data/policies.json')
                    .then(response => response.json())
                    .then(data => {
                        this.policies = data;
                    });

                // Load in the events.json file
                fetch('data/events.json')
                    .then(response => response.json())
                    .then(data => {
                        this.events = data;
                    });

                this.year = 2024;
                this.handlingEvents = false;
                this.activePolicies = {};
                this.currentMenu = "country_select";
                this.selectedItem = 0;
                this.menuElement = document.getElementById('menu');
                this.statsElement = document.getElementById('stats');
                this.policiesElement = document.getElementById('policies');
                this.drawMenu();

                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
            }

            drawMenu() {
                this.menuElement.innerHTML = '';
                let items;
                if (this.currentMenu === "country_select") {
                    items = Object.keys(this.country.countryStats);
                } else if (this.handlingEvents) {
                    items = ["Option 1", "Option 2", "Option 3"];
                } else {
                    items = this.currentMenu === "main" ? this.menuItems :
                        this.submenus[this.currentMenu] ? this.submenus[this.currentMenu] :
                            this.policies[this.currentMenu];
                }
                items.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.textContent = item;
                    div.className = 'menu-item';
                    if (index === this.selectedItem) {
                        div.classList.add('selected');
                    }
                    this.menuElement.appendChild(div);
                });
                this.scrollToSelectedItem();
            }

            scrollToSelectedItem() {
                const selectedElement = this.menuElement.querySelector('.selected');
                if (selectedElement) {
                    selectedElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }

            updateDataBoxes() {
                if (this.handlingEvents == true) {

                    let content;

                    for (const [category, policy] of Object.entries(this.activePolicies)) {
                        content = `
                            <h3>${this.country_name}'s Events during ${this.year}</h3>
                            <h4>${category}:</h4> ${policy}<br>
                        `;
                    }

                    this.statsElement.innerHTML = content;

                } else if (this.country_name) {
                    this.statsElement.innerHTML = `
                        <h3>${this.country_name}'s ${this.year} Stats</h3>
                        <p>Population: ${this.country.population.toFixed(0)}</p>
                        <p>GDP: $${this.country.gdp.toLocaleString()}</p>
                        <p>Corruption Level: ${this.country.corruption_perceptions_index.toFixed(2)}</p>
                        <p>HDI: ${this.country.hdi.toFixed(2)}</p>
                        <p>GINI Index: ${this.country.gini_index.toFixed(2)}</p>
                        <p>Freedom House Rating: ${this.country.freedom_house_rating.toFixed(2)}</p>
                        <p>Fragile States Index: ${this.country.fragile_states_index.toFixed(2)}</p>
                        `;
                } else {
                    this.statsElement.innerHTML = '<h3>Select a country to start</h3>';
                }

                let content = `<h3>${this.country_name}'s Policies for ${this.year}</h3>`;

                for (const [category, policy] of Object.entries(this.activePolicies)) {
                    content += `<h4>${category}:</h4> ${policy}<br>`;
                }

                this.policiesElement.innerHTML = content;
            }

            handleKeyPress(e) {
                switch (e.key) {
                    case 'ArrowUp':
                        this.selectedItem = (this.selectedItem - 1 + this.getCurrentMenuItems().length) % this.getCurrentMenuItems().length;
                        break;
                    case 'ArrowDown':
                        this.selectedItem = (this.selectedItem + 1) % this.getCurrentMenuItems().length;
                        break;
                    case 'Enter':
                        this.selectMenuItem();
                        break;
                }
                this.drawMenu();
            }

            getCurrentMenuItems() {
                if (this.currentMenu === "country_select") {
                    return Object.keys(this.country.countryStats);
                }
                return this.currentMenu === "main" ? this.menuItems :
                    this.submenus[this.currentMenu] ? this.submenus[this.currentMenu] :
                        this.policies[this.currentMenu];
            }

            selectMenuItem() {
                const selected = this.getCurrentMenuItems()[this.selectedItem];
                if (this.currentMenu === "country_select") {
                    this.country_name = selected;
                    this.country.loadStats(this.country_name);
                    this.currentMenu = "main";
                    this.selectedItem = 0;
                } else if (selected === "Back") {
                    this.currentMenu = "main";
                    this.selectedItem = 0;
                } else if (this.submenus[selected]) {
                    this.currentMenu = selected;
                    this.selectedItem = 0;
                } else if (this.policies[selected]) {
                    this.currentMenu = selected;
                    this.selectedItem = 0;
                } else if (selected === "Progress a Year") {
                    this.progressAYear();
                } else if (selected === "Option 1" || selected === "Option 2" || selected === "Option 3") {
                    this.year += 1
                    this.activePolicies = {};
                    this.handlingEvents = false;
                } else {
                    this.togglePolicy(this.currentMenu, selected);
                    this.currentMenu = "main";
                    this.selectedItem = 0;
                }
                this.drawMenu();
                this.updateDataBoxes();
            }

            togglePolicy(category, policy) {
                if (!this.activePolicies[category]) {
                    this.activePolicies[category] = policy;
                } else if (this.activePolicies[category] === policy) {
                    delete this.activePolicies[category];
                } else {
                    this.activePolicies[category] = policy;
                }
                console.log("Active policies:", this.activePolicies);
            }

            applyRandomChanges() {
                const randomFactor = (Math.random() - 0.5) * 0.2;
                this.country.freedom_house_rating += randomFactor;
                this.country.fragile_states_index += randomFactor;
                this.country.corruption_perceptions_index += randomFactor * 0.01;
                this.country.hdi += randomFactor * 0.01;
                this.country.gini_index += randomFactor * 2;
                this.country.gdp += randomFactor * 10;

                // Ensure all values stay within their valid ranges
                this.country.corruption_perceptions_index = Math.max(0, Math.min(1, this.country.corruption_perceptions_index));
                this.country.hdi = Math.max(0, Math.min(1, this.country.hdi));
                this.country.gini_index = Math.max(0, Math.min(100, this.country.gini_index));
                this.country.freedom_house_rating = Math.max(0, Math.min(20, this.country.freedom_house_rating));
                this.country.fragile_states_index = Math.max(0, Math.min(100, this.country.fragile_states_index));
            }

            progressAYear() {
                this.country.population *= 1.01;
                this.applyRandomChanges();
                this.handlingEvents = true;
            }
        }

        new Logic();
    </script>
</body>

</html>